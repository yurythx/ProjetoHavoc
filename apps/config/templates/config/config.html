{% extends "config/base_config.html" %}
{% load crispy_forms_tags %}
{% load static %}

{% block config_title %}Painel de Configura√ß√µes - Projeto Havoc{% endblock %}
{% block config_description %}Central de configura√ß√µes organizadas por m√≥dulos e se√ß√µes{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/components/common.css' %}">
<link rel="stylesheet" href="{% static 'css/config.css' %}">
<style>
.config-module {
    transition: all 0.3s ease;
    border: none;
    border-radius: 15px;
    overflow: hidden;
    height: 100%;
}

.config-module:hover {
    transform: translateY(-5px);
    box-shadow: 0 10px 30px rgba(0,0,0,0.15);
}

.config-module .card-header {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    border: none;
    padding: 1.5rem;
    position: relative;
}

.config-module .module-icon {
    font-size: 2.5rem;
    margin-bottom: 0.5rem;
    display: block;
}

.config-module .card-body {
    padding: 1.5rem;
}

.config-section {
    background: #f8f9fa;
    border-radius: 10px;
    padding: 1rem;
    margin-bottom: 1rem;
    transition: background 0.3s ease;
}

.config-section:hover {
    background: #e9ecef;
}

.section-item {
    display: flex;
    align-items: center;
    padding: 0.75rem;
    border-radius: 8px;
    text-decoration: none;
    color: #495057;
    transition: all 0.3s ease;
    margin-bottom: 0.5rem;
}

.section-item:hover {
    background: white;
    color: #667eea;
    text-decoration: none;
    transform: translateX(5px);
}

.section-item i {
    width: 20px;
    margin-right: 10px;
    text-align: center;
}

.status-badge {
    font-size: 0.75rem;
    padding: 0.25rem 0.5rem;
    border-radius: 12px;
    margin-left: auto;
}

.quick-stats {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    border-radius: 15px;
    padding: 2rem;
    margin-bottom: 2rem;
}

.stat-item {
    text-align: center;
}

.stat-number {
    font-size: 2rem;
    font-weight: 700;
    display: block;
}

.stat-label {
    font-size: 0.9rem;
    opacity: 0.9;
}
</style>
{% endblock %}

{% block config_content %}

<!-- Assistente de Configura√ß√£o -->
{% if user.is_staff %}
<div class="alert alert-info border-0 mb-4" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border-radius: 15px;">
    <div class="row align-items-center">
        <div class="col-md-8">
            <div class="d-flex align-items-center">
                <i class="fas fa-magic me-3" style="font-size: 2.5rem;"></i>
                <div>
                    <h4 class="mb-1">üßô‚Äç‚ôÇÔ∏è Assistente de Configura√ß√£o</h4>
                    <p class="mb-0">Configure seu sistema de forma guiada com detec√ß√£o autom√°tica de ambiente e recomenda√ß√µes personalizadas.</p>
                </div>
            </div>
        </div>
        <div class="col-md-4 text-end">
            <a href="{% url 'config:wizard' %}" class="btn btn-light btn-lg">
                <i class="fas fa-rocket me-2"></i>
                Iniciar Assistente
            </a>
        </div>
    </div>
</div>
{% endif %}

<!-- Estat√≠sticas R√°pidas -->
<div class="quick-stats">
    <div class="row text-center">
        <div class="col-md-3">
            <div class="stat-item">
                <span class="stat-number">{{ app_count|default:0 }}</span>
                <div class="stat-label">M√≥dulos</div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="stat-item">
                <span class="stat-number">{{ active_app_count|default:0 }}</span>
                <div class="stat-label">Ativos</div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="stat-item">
                <span class="stat-number">{{ email_config_count|default:0 }}</span>
                <div class="stat-label">Emails</div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="stat-item">
                <span class="stat-number">{{ stats.total|default:0 }}</span>
                <div class="stat-label">Usu√°rios</div>
            </div>
        </div>
    </div>
</div>

<!-- M√≥dulos de Configura√ß√£o -->
<div class="row">
    <!-- M√≥dulo: Sistema -->
    <div class="col-lg-4 col-md-6 mb-4">
        <div class="card config-module">
            <div class="card-header text-center">
                <i class="fas fa-cogs module-icon"></i>
                <h5 class="mb-0">Sistema</h5>
                <small>Configura√ß√µes gerais</small>
            </div>
            <div class="card-body">
                <div class="config-section">
                    <a href="{% if system_config %}{% url 'config:system-update' system_config.slug %}{% else %}#{% endif %}" class="section-item">
                        <i class="fas fa-globe"></i>
                        <span>Configura√ß√µes Gerais</span>
                        <span class="status-badge bg-success">Ativo</span>
                    </a>
                    <a href="{% url 'config:app-list' %}" class="section-item">
                        <i class="fas fa-puzzle-piece"></i>
                        <span>M√≥dulos</span>
                        <span class="status-badge bg-info">{{ active_app_count }}/{{ app_count }}</span>
                    </a>
                </div>
                <div class="text-center">
                    <small class="text-muted">
                        Site: {{ system_config.site_name|default:"N√£o configurado" }}
                    </small>
                </div>
            </div>
        </div>
    </div>

    <!-- M√≥dulo: Comunica√ß√£o -->
    <div class="col-lg-4 col-md-6 mb-4">
        <div class="card config-module">
            <div class="card-header text-center">
                <i class="fas fa-envelope module-icon"></i>
                <h5 class="mb-0">Comunica√ß√£o</h5>
                <small>Email e notifica√ß√µes</small>
            </div>
            <div class="card-body">
                <div class="config-section">
                    <a href="{% url 'config:email-list' %}" class="section-item">
                        <i class="fas fa-server"></i>
                        <span>Servidores SMTP</span>
                        <span class="status-badge bg-info">{{ email_config_count|default:0 }}</span>
                    </a>
                    <a href="{% url 'config:email-guide' %}" class="section-item">
                        <i class="fas fa-question-circle"></i>
                        <span>Guia de Configura√ß√£o</span>
                    </a>
                    <a href="{% url 'config:email-create' %}" class="section-item">
                        <i class="fas fa-plus"></i>
                        <span>Novo Servidor</span>
                    </a>
                </div>
                <div class="text-center">
                    <small class="text-muted">
                        Ativos: {{ active_email_config_count|default:0 }}
                    </small>
                </div>
            </div>
        </div>
    </div>

    <!-- M√≥dulo: Autentica√ß√£o -->
    <div class="col-lg-4 col-md-6 mb-4">
        <div class="card config-module">
            <div class="card-header text-center">
                <i class="fas fa-shield-alt module-icon"></i>
                <h5 class="mb-0">Autentica√ß√£o</h5>
                <small>LDAP e Social Auth</small>
            </div>
            <div class="card-body">
                <div class="config-section">
                    <a href="{% url 'config:ldap-list' %}" class="section-item">
                        <i class="fas fa-building"></i>
                        <span>Servidores LDAP</span>
                        <span class="status-badge bg-info">{{ ldap_config_count|default:0 }}</span>
                    </a>
                    <a href="{% url 'config:social-provider-list' %}" class="section-item">
                        <i class="fas fa-share-alt"></i>
                        <span>Provedores Sociais</span>
                        <span class="status-badge bg-info">{{ social_provider_count|default:0 }}</span>
                    </a>
                </div>
                <div class="text-center">
                    <small class="text-muted">
                        LDAP: {{ active_ldap_config_count|default:0 }} | Social: {{ active_social_provider_count|default:0 }}
                    </small>
                </div>
            </div>
        </div>
    </div>

    <!-- M√≥dulo: Banco de Dados -->
    <div class="col-lg-4 col-md-6 mb-4">
        <div class="card config-module">
            <div class="card-header text-center">
                <i class="fas fa-database module-icon"></i>
                <h5 class="mb-0">Banco de Dados</h5>
                <small>Conex√µes e configura√ß√µes</small>
            </div>
            <div class="card-body">
                <div class="config-section">
                    <a href="{% url 'config:database-list' %}" class="section-item">
                        <i class="fas fa-server"></i>
                        <span>Configura√ß√µes</span>
                        <span class="status-badge bg-info">{{ database_config_count|default:0 }}</span>
                    </a>
                    <a href="{% url 'config:env-variables' %}" class="section-item">
                        <i class="fas fa-cog"></i>
                        <span>Vari√°veis</span>
                        <span class="status-badge bg-warning">{{ env_variable_count|default:0 }}</span>
                    </a>
                </div>
                <div class="text-center">
                    <small class="text-muted">
                        Ativos: {{ active_database_config_count|default:0 }}
                    </small>
                </div>
            </div>
        </div>
    </div>

    <!-- M√≥dulo: Interface -->
    <div class="col-lg-4 col-md-6 mb-4">
        <div class="card config-module">
            <div class="card-header text-center">
                <i class="fas fa-desktop module-icon"></i>
                <h5 class="mb-0">Interface</h5>
                <small>Widgets e menus</small>
            </div>
            <div class="card-body">
                <div class="config-section">
                    <a href="{% url 'config:widget-list' %}" class="section-item">
                        <i class="fas fa-th-large"></i>
                        <span>Widgets</span>
                        <span class="status-badge bg-info">{{ widget_count|default:0 }}</span>
                    </a>
                    <a href="{% url 'config:menu-list' %}" class="section-item">
                        <i class="fas fa-bars"></i>
                        <span>Menus</span>
                        <span class="status-badge bg-info">{{ menu_count|default:0 }}</span>
                    </a>
                </div>
                <div class="text-center">
                    <small class="text-muted">
                        Widgets: {{ active_widget_count|default:0 }} | Menus: {{ active_menu_count|default:0 }}
                    </small>
                </div>
            </div>
        </div>
    </div>

    <!-- M√≥dulo: Extens√µes -->
    <div class="col-lg-4 col-md-6 mb-4">
        <div class="card config-module">
            <div class="card-header text-center">
                <i class="fas fa-plug module-icon"></i>
                <h5 class="mb-0">Extens√µes</h5>
                <small>Plugins e backup</small>
            </div>
            <div class="card-body">
                <div class="config-section">
                    <a href="{% url 'config:plugin-list' %}" class="section-item">
                        <i class="fas fa-puzzle-piece"></i>
                        <span>Plugins</span>
                        <span class="status-badge bg-info">{{ plugin_count|default:0 }}</span>
                    </a>
                    <a href="{% url 'config:backup-list' %}" class="section-item">
                        <i class="fas fa-save"></i>
                        <span>Backups</span>
                        <span class="status-badge bg-success">{{ backup_count|default:0 }}</span>
                    </a>
                </div>
                <div class="text-center">
                    <small class="text-muted">
                        Plugins: {{ active_plugin_count|default:0 }} | Backups: {{ protected_backup_count|default:0 }}
                    </small>
                </div>
            </div>
        </div>
    </div>

    {% if user.is_staff %}
    <!-- M√≥dulo: Administra√ß√£o (apenas para staff) -->
    <div class="col-lg-4 col-md-6 mb-4">
        <div class="card config-module">
            <div class="card-header text-center">
                <i class="fas fa-users-cog module-icon"></i>
                <h5 class="mb-0">Administra√ß√£o</h5>
                <small>Usu√°rios e sistema</small>
            </div>
            <div class="card-body">
                <div class="config-section">
                    <a href="{% url 'config:user-list' %}" class="section-item">
                        <i class="fas fa-users"></i>
                        <span>Usu√°rios</span>
                        <span class="status-badge bg-info">{{ stats.total|default:0 }}</span>
                    </a>
                    <a href="{% url 'config:backup-create' %}" class="section-item">
                        <i class="fas fa-download"></i>
                        <span>Criar Backup</span>
                    </a>
                </div>
                <div class="text-center">
                    <small class="text-muted">
                        Ativos: {{ stats.active|default:0 }}
                    </small>
                </div>
            </div>
        </div>
    </div>
    {% endif %}
</div>

{% if user.is_staff %}
<!-- Se√ß√£o de A√ß√µes R√°pidas -->
<div class="card">
    <div class="card-header">
        <h5 class="mb-0">
            <i class="fas fa-bolt me-2"></i>
            A√ß√µes R√°pidas
        </h5>
    </div>
    <div class="card-body">
        <div class="row">
            <div class="col-md-3 mb-2">
                <a href="{% url 'config:email-create' %}" class="btn btn-outline-primary btn-sm w-100">
                    <i class="fas fa-plus me-1"></i>Novo Email
                </a>
            </div>
            <div class="col-md-3 mb-2">
                <a href="{% url 'config:user-create' %}" class="btn btn-outline-success btn-sm w-100">
                    <i class="fas fa-user-plus me-1"></i>Novo Usu√°rio
                </a>
            </div>
            <div class="col-md-3 mb-2">
                <a href="{% url 'config:backup-create' %}" class="btn btn-outline-warning btn-sm w-100">
                    <i class="fas fa-save me-1"></i>Backup
                </a>
            </div>
            <div class="col-md-3 mb-2">
                <a href="{% url 'config:env-variable-create' %}" class="btn btn-outline-info btn-sm w-100">
                    <i class="fas fa-cog me-1"></i>Nova Vari√°vel
                </a>
            </div>
        </div>
    </div>
</div>
{% endif %}

{% endblock %}

{% block extra_js %}
<script src="{% static 'js/config-tooltips.js' %}"></script>
<script src="{% static 'js/config-search.js' %}"></script>
{% endblock %}
