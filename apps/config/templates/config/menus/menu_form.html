{% extends "config/base_config.html" %}

{% block config_title %}
    {% if object %}Editar Menu{% else %}Criar Menu{% endif %}
{% endblock %}

{% block config_description %}
    {% if object %}
        Edite as configurações do menu "{{ object.title }}"
    {% else %}
        Configure um novo item de menu para o sistema
    {% endif %}
{% endblock %}

{% block config_content %}

<div class="row">
    <div class="col-lg-8">
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0">
                    {% if object %}
                        <i class="fas fa-edit"></i> Editar Menu
                    {% else %}
                        <i class="fas fa-plus"></i> Criar Novo Menu
                    {% endif %}
                </h5>
            </div>
            <div class="card-body">
                <form method="post">
                    {% csrf_token %}
                    
                    <!-- Informações Básicas -->
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="{{ form.name.id_for_label }}" class="form-label">{{ form.name.label }}</label>
                                {{ form.name }}
                                {% if form.name.help_text %}
                                    <div class="form-text">{{ form.name.help_text }}</div>
                                {% endif %}
                                {% if form.name.errors %}
                                    <div class="invalid-feedback d-block">{{ form.name.errors.0 }}</div>
                                {% endif %}
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="{{ form.menu_type.id_for_label }}" class="form-label">{{ form.menu_type.label }}</label>
                                {{ form.menu_type }}
                                {% if form.menu_type.help_text %}
                                    <div class="form-text">{{ form.menu_type.help_text }}</div>
                                {% endif %}
                                {% if form.menu_type.errors %}
                                    <div class="invalid-feedback d-block">{{ form.menu_type.errors.0 }}</div>
                                {% endif %}
                            </div>
                        </div>
                    </div>

                    <div class="row mb-3">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="{{ form.title.id_for_label }}" class="form-label">{{ form.title.label }}</label>
                                {{ form.title }}
                                {% if form.title.help_text %}
                                    <div class="form-text">{{ form.title.help_text }}</div>
                                {% endif %}
                                {% if form.title.errors %}
                                    <div class="invalid-feedback d-block">{{ form.title.errors.0 }}</div>
                                {% endif %}
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="{{ form.url.id_for_label }}" class="form-label">{{ form.url.label }}</label>
                                {{ form.url }}
                                {% if form.url.help_text %}
                                    <div class="form-text">{{ form.url.help_text }}</div>
                                {% endif %}
                                {% if form.url.errors %}
                                    <div class="invalid-feedback d-block">{{ form.url.errors.0 }}</div>
                                {% endif %}
                            </div>
                        </div>
                    </div>

                    <!-- Hierarquia e Ícone -->
                    <h6 class="border-bottom pb-2 mb-3">Hierarquia e Aparência</h6>
                    <div class="row mb-3">
                        <div class="col-md-4">
                            <div class="mb-3">
                                <label for="{{ form.parent.id_for_label }}" class="form-label">{{ form.parent.label }}</label>
                                {{ form.parent }}
                                {% if form.parent.help_text %}
                                    <div class="form-text">{{ form.parent.help_text }}</div>
                                {% endif %}
                                {% if form.parent.errors %}
                                    <div class="invalid-feedback d-block">{{ form.parent.errors.0 }}</div>
                                {% endif %}
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="mb-3">
                                <label for="{{ form.icon_type.id_for_label }}" class="form-label">{{ form.icon_type.label }}</label>
                                {{ form.icon_type }}
                                {% if form.icon_type.help_text %}
                                    <div class="form-text">{{ form.icon_type.help_text }}</div>
                                {% endif %}
                                {% if form.icon_type.errors %}
                                    <div class="invalid-feedback d-block">{{ form.icon_type.errors.0 }}</div>
                                {% endif %}
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="mb-3">
                                <label for="{{ form.icon.id_for_label }}" class="form-label">{{ form.icon.label }}</label>
                                {{ form.icon }}
                                {% if form.icon.help_text %}
                                    <div class="form-text">{{ form.icon.help_text }}</div>
                                {% endif %}
                                {% if form.icon.errors %}
                                    <div class="invalid-feedback d-block">{{ form.icon.errors.0 }}</div>
                                {% endif %}
                            </div>
                        </div>
                    </div>

                    <div class="row mb-3">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="{{ form.order.id_for_label }}" class="form-label">{{ form.order.label }}</label>
                                {{ form.order }}
                                {% if form.order.help_text %}
                                    <div class="form-text">{{ form.order.help_text }}</div>
                                {% endif %}
                                {% if form.order.errors %}
                                    <div class="invalid-feedback d-block">{{ form.order.errors.0 }}</div>
                                {% endif %}
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="{{ form.css_class.id_for_label }}" class="form-label">{{ form.css_class.label }}</label>
                                {{ form.css_class }}
                                {% if form.css_class.help_text %}
                                    <div class="form-text">{{ form.css_class.help_text }}</div>
                                {% endif %}
                                {% if form.css_class.errors %}
                                    <div class="invalid-feedback d-block">{{ form.css_class.errors.0 }}</div>
                                {% endif %}
                            </div>
                        </div>
                    </div>

                    <!-- Configurações de Comportamento -->
                    <h6 class="border-bottom pb-2 mb-3">Configurações de Comportamento</h6>
                    <div class="row mb-3">
                        <div class="col-md-4">
                            <div class="form-check">
                                {{ form.is_active }}
                                <label class="form-check-label" for="{{ form.is_active.id_for_label }}">
                                    Menu Ativo
                                </label>
                                <small class="form-text text-muted">Menu será exibido na navegação</small>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="form-check">
                                {{ form.is_external }}
                                <label class="form-check-label" for="{{ form.is_external.id_for_label }}">
                                    Link Externo
                                </label>
                                <small class="form-text text-muted">Link para site externo</small>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="form-check">
                                {{ form.open_in_new_tab }}
                                <label class="form-check-label" for="{{ form.open_in_new_tab.id_for_label }}">
                                    Abrir em Nova Aba
                                </label>
                                <small class="form-text text-muted">Abrir link em nova aba</small>
                            </div>
                        </div>
                    </div>

                    <!-- Configurações de Acesso -->
                    <h6 class="border-bottom pb-2 mb-3">Configurações de Acesso</h6>
                    <div class="row mb-3">
                        <div class="col-md-4">
                            <div class="form-check">
                                {{ form.staff_only }}
                                <label class="form-check-label" for="{{ form.staff_only.id_for_label }}">
                                    Apenas Staff
                                </label>
                                <small class="form-text text-muted">Visível apenas para staff</small>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="form-check">
                                {{ form.authenticated_only }}
                                <label class="form-check-label" for="{{ form.authenticated_only.id_for_label }}">
                                    Apenas Autenticados
                                </label>
                                <small class="form-text text-muted">Visível apenas para usuários logados</small>
                            </div>
                        </div>
                    </div>

                    <div class="row mb-3">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="{{ form.required_permission.id_for_label }}" class="form-label">{{ form.required_permission.label }}</label>
                                {{ form.required_permission }}
                                {% if form.required_permission.help_text %}
                                    <div class="form-text">{{ form.required_permission.help_text }}</div>
                                {% endif %}
                                {% if form.required_permission.errors %}
                                    <div class="invalid-feedback d-block">{{ form.required_permission.errors.0 }}</div>
                                {% endif %}
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="{{ form.required_group.id_for_label }}" class="form-label">{{ form.required_group.label }}</label>
                                {{ form.required_group }}
                                {% if form.required_group.help_text %}
                                    <div class="form-text">{{ form.required_group.help_text }}</div>
                                {% endif %}
                                {% if form.required_group.errors %}
                                    <div class="invalid-feedback d-block">{{ form.required_group.errors.0 }}</div>
                                {% endif %}
                            </div>
                        </div>
                    </div>

                    <!-- Badge -->
                    <h6 class="border-bottom pb-2 mb-3">Badge (Opcional)</h6>
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="{{ form.badge_text.id_for_label }}" class="form-label">{{ form.badge_text.label }}</label>
                                {{ form.badge_text }}
                                {% if form.badge_text.help_text %}
                                    <div class="form-text">{{ form.badge_text.help_text }}</div>
                                {% endif %}
                                {% if form.badge_text.errors %}
                                    <div class="invalid-feedback d-block">{{ form.badge_text.errors.0 }}</div>
                                {% endif %}
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="{{ form.badge_color.id_for_label }}" class="form-label">{{ form.badge_color.label }}</label>
                                {{ form.badge_color }}
                                {% if form.badge_color.help_text %}
                                    <div class="form-text">{{ form.badge_color.help_text }}</div>
                                {% endif %}
                                {% if form.badge_color.errors %}
                                    <div class="invalid-feedback d-block">{{ form.badge_color.errors.0 }}</div>
                                {% endif %}
                            </div>
                        </div>
                    </div>

                    <!-- Botões de Ação -->
                    <div class="d-flex justify-content-between mt-4">
                        <a href="{% url 'config:menu-list' %}" class="btn btn-secondary">
                            <i class="fas fa-arrow-left"></i> Voltar
                        </a>
                        <div>
                            {% if object %}
                                <button type="submit" class="btn btn-primary">
                                    <i class="fas fa-save"></i> Salvar Alterações
                                </button>
                            {% else %}
                                <button type="submit" class="btn btn-success">
                                    <i class="fas fa-plus"></i> Criar Menu
                                </button>
                            {% endif %}
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Painel de Informações -->
    <div class="col-lg-4">
        <div class="card">
            <div class="card-header">
                <h6 class="mb-0"><i class="fas fa-info-circle"></i> Informações</h6>
            </div>
            <div class="card-body">
                <h6>Tipos de Menu Disponíveis:</h6>
                <ul class="list-unstyled small">
                    <li><strong>Principal:</strong> Menu principal do sistema</li>
                    <li><strong>Lateral:</strong> Menu lateral/sidebar</li>
                    <li><strong>Rodapé:</strong> Links no rodapé</li>
                    <li><strong>Topo:</strong> Menu no topo da página</li>
                    <li><strong>Usuário:</strong> Menu do perfil do usuário</li>
                </ul>

                <hr>

                <h6>Tipos de Ícone:</h6>
                <ul class="list-unstyled small">
                    <li><strong>FontAwesome:</strong> fas fa-home</li>
                    <li><strong>Bootstrap:</strong> bi-house</li>
                    <li><strong>Personalizado:</strong> URL da imagem</li>
                </ul>

                <hr>

                <h6>Dicas:</h6>
                <ul class="list-unstyled small text-muted">
                    <li>• Use hierarquia para criar submenus</li>
                    <li>• A ordem determina a posição no menu</li>
                    <li>• Badges são úteis para notificações</li>
                    <li>• Configure permissões para controlar acesso</li>
                    <li>• Links externos abrem em nova aba automaticamente</li>
                </ul>
            </div>
        </div>

        {% if object %}
        <div class="card mt-3">
            <div class="card-header">
                <h6 class="mb-0"><i class="fas fa-chart-line"></i> Estatísticas</h6>
            </div>
            <div class="card-body">
                <dl class="row small">
                    <dt class="col-6">Criado em:</dt>
                    <dd class="col-6">{{ object.created_at|date:"d/m/Y H:i" }}</dd>
                    
                    <dt class="col-6">Atualizado em:</dt>
                    <dd class="col-6">{{ object.updated_at|date:"d/m/Y H:i" }}</dd>
                    
                    <dt class="col-6">Slug:</dt>
                    <dd class="col-6"><code>{{ object.slug }}</code></dd>
                    
                    {% if object.children.exists %}
                    <dt class="col-6">Submenus:</dt>
                    <dd class="col-6">{{ object.children.count }}</dd>
                    {% endif %}
                </dl>
            </div>
        </div>
        {% endif %}
    </div>
</div>

{% endblock %}
